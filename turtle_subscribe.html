<html>

<head>
    <!-- include jquery library ... required in the sample -->
    <!-- <script   src="https://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script> -->
    <script src="assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="http://cdn.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js">
    </script>

    <!-- include the roslibjs library ... required -->
    <script type="text/javascript" src="http://cdn.robotwebtools.org/roslibjs/current/roslib.min.js">
    </script>



    <script type="text/javascript">
        var ros = new ROSLIB.Ros({
            url: 'ws://localhost:9090' // url to your rosbridge server
            //url: 'ws://192.168.1.2:9090' // url to your rosbridge server
        });

        ros.on('connection', function() {
            console.log('Connected to websocket server.');
        });

        ros.on('error', function(error) {
            console.log('Error connecting to websocket server: ', error);
        });

        ros.on('close', function() {
            console.log('Connection to websocket server closed.');
        });

        var exampleTopic = new ROSLIB.Topic({
            ros: ros,
            name: '/test_topic', // use a sensible namespace
            messageType: 'std_msgs/String' //Create a pose object (geometry_msg(s)/Pose)

        });

        var turtle = new ROSLIB.Topic({
            ros: ros,
            name: '/turtle1/cmd_vel', // use a sensible namespace
            messageType: 'geometry_msgs/Twist' //Create a pose object (geometry_msg(s)/Pose)

        });


        function publishEncoded(topic, obj) {
            var msg = new ROSLIB.Message({

                data: JSON.stringify(obj)
            });
            topic.publish(msg);
        }

        function decodeMessage(msg) {
            return JSON.parse(msg.data);
        }

        // Example of subscribing to a topic with decodeMessage().
        exampleTopic.subscribe(function(msg) {
            console.log("EXAMPLETOPIC");
            var decoded = decodeMessage(msg);
            // do something with the decod// Explicitly declare that we intend to publish on this Topic.
            console.log("FUBARRRR");
            $('#topic_data').text("FOO");
        });

        turtle.subscribe(function(msg) {
            // console.log("FUBAR!");
            //  console.log(jointTopic.name);
            // var decoded = decodeMessage(msg);
            // // do something with the decod// Explicitly declare that we intend to publish on this Topic.
            // console.log(decoded);
            console.log(msg);
            var linear = 'x: ' + msg.linear.x +
                ' y: ' + msg.linear.y +
                ' z: ' + msg.linear.z;
            var angular = ' x: ' + msg.angular.x +
                ' y: ' + msg.angular.y +
                ' z: ' + msg.angular.z;

            $('#topic_data').text(linear + angular);
            $('#linx').text(msg.linear.x);
            $('#liny').text(msg.linear.y);
            $('#linz').text(msg.linear.z);
            $('#angx').text(msg.angular.x);
            $('#angy').text(msg.angular.y);
            $('#angz').text(msg.angular.z);
            // $('#topic_data').text(msg.linear.x + msg.angular.z ) ;
            // $('#topic_data').text(msg.linear.x + msg.linear.y + msg.linear.z);
            // $('#topic_data').text(msg.angular.x + msg.angular.y + msg.angular.z);

        });
        $.fn.multiline = function(text) {
            this.text(text);
            this.html(this.html().replace(/\n/g, '<br/>'));
            return this;
        }

        $(document).ready(function() {
            console.log("Hello there!");
        })
    </script>
</head>

<body>

    <div>Topic data: <span id="topic_data"></span></div>
    <br />
    <br />

    <div>Linear x: <span id="linx"></span></div>
    <div>Linear y: <span id="liny"></span></div>
    <div>Linear z: <span id="linz"></span></div>
    <div>Angular x: <span id="angx"></span></div>
    <div>Angular y: <span id="angy"></span></div>
    <div>Angular z: <span id="angz"></span></div>

</body>

</html>
